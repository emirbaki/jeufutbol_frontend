<div class="max-w-6xl mx-auto p-6">
  <!-- Header -->
  <div class="flex items-center justify-between mb-6">
    <h2 class="text-3xl font-bold text-gray-900 dark:text-white">ðŸ“ˆ Insights Dashboard</h2>
    <button
      (click)="generateNewInsights()"
      [disabled]="generatingInsights()"
      class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed"
    >
      {{ generatingInsights() ? 'Generating...' : 'âœ¨ Generate Insights' }}
    </button>
  </div>

  <!-- Filter Dropdown -->
  <div class="flex items-center gap-3 mb-6">
    <label class="font-medium text-gray-700 dark:text-gray-300">Filter by Type:</label>
    <select
      [ngModel]="selectedType()"
      (ngModelChange)="selectedType.set($event)"
      class="border border-gray-300 dark:border-neutral-700 bg-white dark:bg-neutral-800 text-gray-900 dark:text-white rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
    >
      <option value="all">All</option>
      @for (type of insightTypes; track type) {
      <option [value]="type">{{ type }}</option>
      }
    </select>
  </div>

  <!-- Loading State -->
  @if (loading()) {
  <div class="text-center py-10 text-neutral-500 dark:text-neutral-400">Loading insights...</div>
  }

  <!-- No Insights -->
  @if (!loading() && filteredInsights().length === 0) {
  <div class="text-center py-10 text-neutral-500 dark:text-neutral-400">No insights available.</div>
  }

  <!-- Insights List -->
  @if (!loading() && filteredInsights().length > 0) {
  <div class="grid gap-4">
    @for (insight of filteredInsights(); track insight.id) {
    <div
      class="bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-800 rounded-xl p-4 shadow-sm hover:shadow-md transition"
    >
      <!-- Header -->
      <div class="flex items-start justify-between">
        <div class="flex items-center gap-2">
          <span class="text-xl">{{ getInsightIcon(insight.type) }}</span>
          <h3 class="font-semibold text-lg text-gray-900 dark:text-white">{{ insight.title }}</h3>
        </div>
        <span class="px-2 py-1 text-xs rounded-full" [ngClass]="getInsightColor(insight.type)">
          {{ insight.type }}
        </span>
      </div>

      <!-- Description -->
      <p class="mt-2 text-neutral-700 dark:text-neutral-300">{{ insight.description }}</p>

      <!-- Relevance Bar -->
      <div class="mt-3">
        <div class="h-2 bg-neutral-200 dark:bg-neutral-700 rounded-full overflow-hidden">
          <div
            class="h-2 bg-indigo-500 rounded-full"
            [style.width]="getRelevanceBarWidth(insight.relevanceScore)"
          ></div>
        </div>
        <span class="text-xs text-neutral-500 dark:text-neutral-400">
          Relevance: {{ insight.relevanceScore * 100 | number : '1.0-0' }}%
        </span>
      </div>

      <!-- Footer -->
      <div class="mt-4 flex items-center justify-between">
        <button
          (click)="markAsRead(insight)"
          [disabled]="insight.isRead"
          class="text-sm px-3 py-1 rounded-md border transition"
          [class.bg-neutral-200]="insight.isRead"
          [class.dark:bg-neutral-700]="insight.isRead"
          [class.text-neutral-500]="insight.isRead"
          [class.dark:text-neutral-400]="insight.isRead"
          [class.bg-indigo-100]="!insight.isRead"
          [class.dark:bg-indigo-900]="!insight.isRead"
          [class.dark:bg-opacity-30]="!insight.isRead"
          [class.text-indigo-700]="!insight.isRead"
          [class.dark:text-indigo-300]="!insight.isRead"
          [class.border-transparent]="!insight.isRead"
          [class.border-neutral-300]="insight.isRead"
          [class.dark:border-neutral-600]="insight.isRead"
        >
          {{ insight.isRead ? 'Read' : 'Mark as Read' }}
        </button>

        @if (insight.createdAt) {
        <span class="text-xs text-neutral-400 dark:text-neutral-500">
          {{ insight.createdAt | date : 'medium' }}
        </span>
        }
      </div>
    </div>
    }
  </div>
  }
</div>
