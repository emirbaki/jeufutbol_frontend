<div class="max-w-7xl mx-auto insights-container">
  <!-- Header -->
  <div class="mb-8">
    <div class="flex items-center justify-between mb-2">
      <div>
        <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">ğŸ’¡ AI Insights</h1>
        <p class="text-gray-600 dark:text-gray-400">
          Discover trends, patterns, and opportunities powered by AI
        </p>
      </div>
      <button
        (click)="generateNewInsights()"
        [disabled]="generatingInsights()"
        class="px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white rounded-xl font-medium transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl flex items-center gap-2 group"
      >
        @if (generatingInsights()) {
          <div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
          <span>Generating...</span>
        } @else {
          <span class="text-xl group-hover:scale-110 transition-transform">âœ¨</span>
          <span>Generate Insights</span>
        }
      </button>
    </div>

    <!-- Stats Bar -->
    @if (insights().length > 0) {
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
        <div class="bg-white dark:bg-neutral-900 rounded-xl p-4 border border-gray-200 dark:border-neutral-800 shadow-sm">
          <div class="flex items-center gap-3">
            <div class="p-3 bg-indigo-100 dark:bg-indigo-900/30 rounded-lg">
              <span class="text-2xl">ğŸ“Š</span>
            </div>
            <div>
              <p class="text-sm text-gray-600 dark:text-gray-400">Total Insights</p>
              <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ insights().length }}</p>
            </div>
          </div>
        </div>
        <div class="bg-white dark:bg-neutral-900 rounded-xl p-4 border border-gray-200 dark:border-neutral-800 shadow-sm">
          <div class="flex items-center gap-3">
            <div class="p-3 bg-green-100 dark:bg-green-900/30 rounded-lg">
              <span class="text-2xl">âœ…</span>
            </div>
            <div>
              <p class="text-sm text-gray-600 dark:text-gray-400">Read</p>
              <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ insights().length - unreadCount() }}</p>
            </div>
          </div>
        </div>
        <div class="bg-white dark:bg-neutral-900 rounded-xl p-4 border border-gray-200 dark:border-neutral-800 shadow-sm">
          <div class="flex items-center gap-3">
            <div class="p-3 bg-orange-100 dark:bg-orange-900/30 rounded-lg">
              <span class="text-2xl">ğŸ””</span>
            </div>
            <div>
              <p class="text-sm text-gray-600 dark:text-gray-400">Unread</p>
              <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ unreadCount() }}</p>
            </div>
          </div>
        </div>
      </div>
    }
  </div>

  <!-- Filter Section -->
  <div class="bg-white dark:bg-neutral-900 rounded-xl p-4 border border-gray-200 dark:border-neutral-800 shadow-sm mb-6">
    <div class="flex flex-col md:flex-row items-start md:items-center gap-4">
      <!-- Type Filter -->
      <div class="flex items-center gap-3 flex-1">
        <label class="font-medium text-gray-700 dark:text-gray-300 flex items-center gap-2 whitespace-nowrap">
          <span class="text-lg">ğŸ”</span>
          <span>Type:</span>
        </label>
        <select
          [ngModel]="selectedType()"
          (ngModelChange)="selectedType.set($event)"
          class="flex-1 border border-gray-300 dark:border-neutral-700 bg-white dark:bg-neutral-800 text-gray-900 dark:text-white rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-shadow"
        >
          <option value="all">All Types ({{ insights().length }})</option>
          @for (type of insightTypes; track type) {
            <option [value]="type">{{ type }} ({{ getInsightCountByType(type) }})</option>
          }
        </select>
      </div>

      <!-- Read Status Filter -->
      <div class="flex items-center gap-3 flex-1">
        <label class="font-medium text-gray-700 dark:text-gray-300 flex items-center gap-2 whitespace-nowrap">
          <span class="text-lg">ğŸ“–</span>
          <span>Status:</span>
        </label>
        <select
          [ngModel]="selectedReadStatus()"
          (ngModelChange)="selectedReadStatus.set($event)"
          class="flex-1 border border-gray-300 dark:border-neutral-700 bg-white dark:bg-neutral-800 text-gray-900 dark:text-white rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-shadow"
        >
          <option value="all">All ({{ insights().length }})</option>
          <option value="unread">Unread ({{ unreadCount() }})</option>
          <option value="read">Read ({{ insights().length - unreadCount() }})</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="flex flex-col items-center justify-center py-20">
      <div class="w-16 h-16 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin mb-4"></div>
      <p class="text-gray-600 dark:text-gray-400 font-medium">Loading insights...</p>
    </div>
  }

  <!-- Empty State -->
  @if (!loading() && filteredInsights().length === 0) {
    <div class="flex flex-col items-center justify-center py-20">
      <div class="text-8xl mb-6 bg-gray-50 dark:bg-neutral-800 p-8 rounded-full">
        @if (selectedType() === 'all') {
          ğŸ’­
        } @else {
          ğŸ”
        }
      </div>
      <h3 class="text-2xl font-semibold text-gray-900 dark:text-white mb-2">
        @if (selectedType() === 'all') {
          No Insights Yet
        } @else {
          No {{ selectedType() }} Insights
        }
      </h3>
      <p class="text-gray-600 dark:text-gray-400 max-w-md text-center mb-6">
        @if (selectedType() === 'all') {
          Generate AI-powered insights to discover trends and opportunities for your content strategy.
        } @else {
          Try selecting a different filter or generate new insights.
        }
      </p>
      @if (selectedType() === 'all') {
        <button
          (click)="generateNewInsights()"
          [disabled]="generatingInsights()"
          class="px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed"
        >
          {{ generatingInsights() ? 'Generating...' : 'âœ¨ Generate Your First Insights' }}
        </button>
      }
    </div>
  }

  <!-- Insights Grid -->
  @if (!loading() && filteredInsights().length > 0) {
    <div class="grid gap-4">
      @for (insight of filteredInsights(); track insight.id) {
        <div
          #insightCard
          class="insight-card bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-800 rounded-xl p-6 shadow-sm hover:shadow-lg transition-all duration-300 group relative overflow-hidden"
        >
          <!-- Unread indicator -->
          @if (!insight.isRead) {
            <div class="absolute top-0 left-0 w-1 h-full bg-gradient-to-b from-indigo-500 to-purple-500"></div>
          }

          <!-- Header -->
          <div class="flex items-start justify-between mb-4">
            <div class="flex items-center gap-3 flex-1">
              <div class="text-3xl p-2 bg-gray-50 dark:bg-neutral-800 rounded-lg group-hover:scale-110 transition-transform">
                {{ getInsightIcon(insight.type) }}
              </div>
              <div class="flex-1">
                <h3 class="font-bold text-xl text-gray-900 dark:text-white mb-1">
                  {{ insight.title }}
                </h3>
                <span 
                  class="inline-flex items-center px-3 py-1 text-xs font-medium rounded-full border"
                  [ngClass]="getInsightColor(insight.type)"
                >
                  {{ insight.type }}
                </span>
              </div>
            </div>
            @if (!insight.isRead) {
              <div class="flex items-center gap-2 px-3 py-1 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded-full text-xs font-medium">
                <span class="w-2 h-2 bg-indigo-500 rounded-full animate-pulse"></span>
                New
              </div>
            }
          </div>

          <!-- Description -->
          <p class="text-gray-700 dark:text-gray-300 leading-relaxed mb-4">
            {{ insight.description }}
          </p>

          <!-- Relevance Bar -->
          <div class="mb-4">
            <div class="flex items-center justify-between mb-2">
              <span class="text-sm font-medium text-gray-600 dark:text-gray-400">Relevance Score</span>
              <span class="text-sm font-bold text-gray-900 dark:text-white">
                {{ insight.relevanceScore * 100 | number : '1.0-0' }}%
              </span>
            </div>
            <div class="h-3 bg-gray-200 dark:bg-neutral-700 rounded-full overflow-hidden shadow-inner">
              <div
                class="h-3 rounded-full transition-all duration-500"
                [ngClass]="getRelevanceColor(insight.relevanceScore)"
                [style.width]="getRelevanceBarWidth(insight.relevanceScore)"
              ></div>
            </div>
          </div>

          <!-- Footer -->
          <div class="flex items-center justify-between pt-4 border-t border-gray-100 dark:border-neutral-800">
            <button
              (click)="markAsRead(insight)"
              [disabled]="insight.isRead"
              class="px-4 py-2 rounded-lg font-medium text-sm transition-all duration-200 flex items-center gap-2"
              [class.bg-gray-100]="insight.isRead"
              [class.dark:bg-neutral-800]="insight.isRead"
              [class.text-gray-500]="insight.isRead"
              [class.dark:text-neutral-400]="insight.isRead"
              [class.cursor-not-allowed]="insight.isRead"
              [class.bg-indigo-100]="!insight.isRead"
              [class.dark:bg-indigo-900/30]="!insight.isRead"
              [class.text-indigo-700]="!insight.isRead"
              [class.dark:text-indigo-300]="!insight.isRead"
              [class.hover:bg-indigo-200]="!insight.isRead"
              [class.dark:hover:bg-indigo-900/50]="!insight.isRead"
            >
              @if (insight.isRead) {
                <span>âœ“</span>
                <span>Read</span>
              } @else {
                <span>ğŸ‘ï¸</span>
                <span>Mark as Read</span>
              }
            </button>

            <div class="flex items-center gap-3 text-sm text-gray-500 dark:text-gray-400">
              @if (insight.user) {
                <div class="flex items-center gap-1">
                  <span>ğŸ‘¤</span>
                  <span>{{insight.user.firstName}} {{insight.user.lastName}}</span>
                </div>
              }
              @if (insight.createdAt) {
                <div class="flex items-center gap-1">
                  <span>ğŸ•</span>
                  <span>{{ insight.createdAt | date : 'MMM d, y' }}</span>
                </div>
              }
            </div>
          </div>
        </div>
      }
    </div>
  }
</div>
