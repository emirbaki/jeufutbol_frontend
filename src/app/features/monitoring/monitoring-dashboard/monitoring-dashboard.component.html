<div class="max-w-7xl mx-auto">
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">Profile Monitoring</h1>
    <p class="text-gray-600">Track X profiles to discover trends and content ideas</p>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
    <!-- Profiles Sidebar -->
    <div class="lg:col-span-1 space-y-4">
      <!-- View Mode Toggle -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
        <h3 class="text-sm font-semibold text-gray-900 mb-3">View Mode</h3>
        <div class="flex gap-2">
          <button
            (click)="switchToTimeline()"
            [class.bg-indigo-600]="viewMode() === 'timeline'"
            [class.text-white]="viewMode() === 'timeline'"
            [class.bg-gray-100]="viewMode() !== 'timeline'"
            [class.text-gray-700]="viewMode() !== 'timeline'"
            class="flex-1 px-3 py-2 text-sm font-medium rounded-lg transition-colors">
            üì∞ Timeline
          </button>
          <button
            [disabled]="!selectedProfile()"
            [class.bg-indigo-600]="viewMode() === 'single'"
            [class.text-white]="viewMode() === 'single'"
            [class.bg-gray-100]="viewMode() !== 'single' && selectedProfile()"
            [class.text-gray-700]="viewMode() !== 'single' && selectedProfile()"
            [class.opacity-50]="!selectedProfile()"
            [class.cursor-not-allowed]="!selectedProfile()"
            class="flex-1 px-3 py-2 text-sm font-medium rounded-lg transition-colors">
            üë§ Single
          </button>
        </div>
      </div>

      <!-- Add Profile -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
        <h3 class="text-sm font-semibold text-gray-900 mb-3">Add Profile to Monitor</h3>
        <div class="flex gap-2">
          <input
            type="text"
            [(ngModel)]="newUsername"
            placeholder="@username"
            (keyup.enter)="addProfile()"
            class="flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
          <button
            (click)="addProfile()"
            [disabled]="addingProfile() || !newUsername().trim()"
            class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm">
            {{ addingProfile() ? '...' : '+' }}
          </button>
        </div>
      </div>

      <!-- Monitored Profiles -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-200">
        <div class="p-4 border-b border-gray-200">
          <h3 class="text-sm font-semibold text-gray-900">Monitored Profiles ({{ profiles().length }})</h3>
        </div>
        <div class="max-h-[500px] overflow-y-auto">
          @if (profiles().length === 0) {
            <div class="p-8 text-center text-gray-500 text-sm">
              No profiles yet.<br>Add one to get started!
            </div>
          }
          @for (profile of profiles(); track profile.id) {
            <button
              (click)="selectProfile(profile)"
              [class.bg-indigo-50]="selectedProfile()?.id === profile.id && viewMode() === 'single'"
              [class.border-indigo-500]="selectedProfile()?.id === profile.id && viewMode() === 'single'"
              class="w-full p-4 border-b border-gray-200 hover:bg-gray-50 transition-colors text-left flex items-center gap-3 group">
              @if (profile.profileImageUrl) {
                <img
                  [src]="profile.profileImageUrl"
                  [alt]="profile.xUsername"
                  class="w-10 h-10 rounded-full">
              } @else {
                <div class="w-10 h-10 bg-gray-300 rounded-full"></div>
              }
              <div class="flex-1 min-w-0">
                <p class="font-semibold text-gray-900 text-sm truncate">{{ profile.displayName || profile.xUsername }}</p>
                <p class="text-xs text-gray-500">@{{ profile.xUsername }}</p>
              </div>
              <button
                (click)="removeProfile(profile, $event)"
                class="opacity-0 group-hover:opacity-100 text-red-500 hover:text-red-700 transition-opacity">
                ‚úï
              </button>
            </button>
          }
        </div>
      </div>
    </div>

    <!-- Content Area -->
    <div class="lg:col-span-3">
      <div class="bg-white rounded-xl shadow-sm border border-gray-200">
        
        <!-- Timeline View -->
        @if (viewMode() === 'timeline') {
          <!-- Timeline Header -->
          <div class="p-6 border-b border-gray-200">
            <h2 class="text-xl font-bold text-gray-900">Timeline</h2>
            <p class="text-gray-600 text-sm">All tweets from monitored profiles</p>
          </div>

          <!-- No Profiles -->
          @if (profiles().length === 0) {
            <div class="p-12 text-center">
              <div class="text-6xl mb-4">üë•</div>
              <h3 class="text-xl font-semibold text-gray-700 mb-2">No Profiles to Monitor</h3>
              <p class="text-gray-600">Add profiles to see their tweets in your timeline</p>
            </div>
          }

          <!-- Loading Timeline -->
          @if (loading() && profiles().length > 0) {
            <div class="p-12 text-center">
              <div class="animate-spin text-4xl mb-4">‚öôÔ∏è</div>
              <p class="text-gray-600">Loading timeline...</p>
            </div>
          }

          <!-- Timeline Tweets -->
          @if (!loading() && timelineTweets().length > 0) {
            <div class="divide-y divide-gray-200">
              @for (tweet of timelineTweets(); track tweet.id) {
                <div class="p-6 hover:bg-gray-50 transition-colors">
                  <div class="flex gap-4">
                    @if (tweet.profile.profileImageUrl) {
                      <img
                        [src]="tweet.profile.profileImageUrl"
                        [alt]="tweet.profile.xUsername"
                        class="w-12 h-12 rounded-full flex-shrink-0">
                    } @else {
                      <div class="w-12 h-12 bg-gray-300 rounded-full flex-shrink-0"></div>
                    }
                    
                    <div class="flex-1 min-w-0">
                      <!-- Tweet Header -->
                      <div class="flex items-center gap-2 mb-2">
                        <span class="font-bold text-gray-900">{{ tweet.profile.displayName || tweet.profile.xUsername }}</span>
                        <span class="text-gray-500">@{{ tweet.profile.xUsername }}</span>
                        <span class="text-gray-500">¬∑</span>
                        <span class="text-gray-500 text-sm">{{ tweet.createdAt | date:'MMM d' }}</span>
                      </div>

                      <!-- Tweet Content -->
                      <p class="text-gray-900 mb-3 whitespace-pre-wrap">{{ tweet.content }}</p>

                      <!-- Tweet Media -->
                      @if (tweet.mediaUrls && tweet.mediaUrls.length > 0) {
                        <div class="grid grid-cols-2 gap-2 mb-3">
                          @for (url of tweet.mediaUrls.slice(0, 4); track url) {
                            <img
                              [src]="url"
                              class="w-full h-48 object-cover rounded-lg">
                          }
                        </div>
                      }

                      <!-- Hashtags -->
                      @if (tweet.hashtags && tweet.hashtags.length > 0) {
                        <div class="flex flex-wrap gap-2 mb-3">
                          @for (tag of tweet.hashtags; track tag) {
                            <span class="text-sm text-indigo-600">#{{ tag }}</span>
                          }
                        </div>
                      }

                      <!-- Tweet Stats -->
                      <div class="flex items-center gap-6 text-gray-600 text-sm">
                        <div class="flex items-center gap-1">
                          <span>üí¨</span>
                          <span>{{ formatNumber(tweet.replies) }}</span>
                        </div>
                        <div class="flex items-center gap-1">
                          <span>üîÑ</span>
                          <span>{{ formatNumber(tweet.retweets) }}</span>
                        </div>
                        <div class="flex items-center gap-1">
                          <span>‚ù§Ô∏è</span>
                          <span>{{ formatNumber(tweet.likes) }}</span>
                        </div>
                        <div class="flex items-center gap-1">
                          <span>üëÅÔ∏è</span>
                          <span>{{ formatNumber(tweet.views) }}</span>
                        </div>
                        <div class="ml-auto flex items-center gap-1">
                          <span class="text-xs">Engagement:</span>
                          <span class="text-xs font-semibold">{{ getEngagementRate(tweet).toFixed(2) }}%</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              }
            </div>
          }

          <!-- Empty Timeline -->
          @if (!loading() && profiles().length > 0 && timelineTweets().length === 0) {
            <div class="p-12 text-center">
              <div class="text-6xl mb-4">üì≠</div>
              <h3 class="text-xl font-semibold text-gray-700 mb-2">No Tweets Yet</h3>
              <p class="text-gray-600">Tweets from your monitored profiles will appear here</p>
            </div>
          }
        }

        <!-- Single Profile View -->
        @if (viewMode() === 'single') {
          <!-- Profile Header -->
          @if (selectedProfile()) {
            <div class="p-6 border-b border-gray-200">
              <div class="flex items-center gap-4">
                @if (selectedProfile()!.profileImageUrl) {
                  <img
                    [src]="selectedProfile()!.profileImageUrl"
                    [alt]="selectedProfile()!.xUsername"
                    class="w-16 h-16 rounded-full">
                } @else {
                  <div class="w-16 h-16 bg-gray-300 rounded-full"></div>
                }
                <div>
                  <h2 class="text-xl font-bold text-gray-900">{{ selectedProfile()!.displayName || selectedProfile()!.xUsername }}</h2>
                  <p class="text-gray-600">@{{ selectedProfile()!.xUsername }}</p>
                  <p class="text-xs text-gray-500 mt-1">
                    Last updated: {{ selectedProfile()!.lastFetchedAt ? (selectedProfile()!.lastFetchedAt | date:'short') : 'Never' }}
                  </p>
                </div>
              </div>
            </div>
          }

          <!-- No Profile Selected -->
          @if (!selectedProfile()) {
            <div class="p-12 text-center">
              <div class="text-6xl mb-4">üëÄ</div>
              <h3 class="text-xl font-semibold text-gray-700 mb-2">No Profile Selected</h3>
              <p class="text-gray-600">Select a profile from the sidebar to view their tweets</p>
            </div>
          }

          <!-- Loading -->
          @if (loading() && selectedProfile()) {
            <div class="p-12 text-center">
              <div class="animate-spin text-4xl mb-4">‚öôÔ∏è</div>
              <p class="text-gray-600">Loading tweets...</p>
            </div>
          }

          <!-- Tweets List -->
          @if (!loading() && selectedProfile() && tweets().length > 0) {
            <div class="divide-y divide-gray-200">
              @for (tweet of tweets(); track tweet.id) {
                <div class="p-6 hover:bg-gray-50 transition-colors">
                  <div class="flex gap-4">
                    @if (selectedProfile()!.profileImageUrl) {
                      <img
                        [src]="selectedProfile()!.profileImageUrl"
                        [alt]="selectedProfile()!.xUsername"
                        class="w-12 h-12 rounded-full flex-shrink-0">
                    } @else {
                      <div class="w-12 h-12 bg-gray-300 rounded-full flex-shrink-0"></div>
                    }
                    
                    <div class="flex-1 min-w-0">
                      <!-- Tweet Header -->
                      <div class="flex items-center gap-2 mb-2">
                        <span class="font-bold text-gray-900">{{ selectedProfile()!.displayName || selectedProfile()!.xUsername }}</span>
                        <span class="text-gray-500">@{{ selectedProfile()!.xUsername }}</span>
                        <span class="text-gray-500">¬∑</span>
                        <span class="text-gray-500 text-sm">{{ tweet.createdAt | date:'MMM d' }}</span>
                      </div>

                      <!-- Tweet Content -->
                      <p class="text-gray-900 mb-3 whitespace-pre-wrap">{{ tweet.content }}</p>

                      <!-- Tweet Media -->
                      @if (tweet.mediaUrls && tweet.mediaUrls.length > 0) {
                        <div class="grid grid-cols-2 gap-2 mb-3">
                          @for (url of tweet.mediaUrls.slice(0, 4); track url) {
                            <img
                              [src]="url"
                              class="w-full h-48 object-cover rounded-lg">
                          }
                        </div>
                      }

                      <!-- Hashtags -->
                      @if (tweet.hashtags && tweet.hashtags.length > 0) {
                        <div class="flex flex-wrap gap-2 mb-3">
                          @for (tag of tweet.hashtags; track tag) {
                            <span class="text-sm text-indigo-600">#{{ tag }}</span>
                          }
                        </div>
                      }

                      <!-- Tweet Stats -->
                      <div class="flex items-center gap-6 text-gray-600 text-sm">
                        <div class="flex items-center gap-1">
                          <span>üí¨</span>
                          <span>{{ formatNumber(tweet.replies) }}</span>
                        </div>
                        <div class="flex items-center gap-1">
                          <span>üîÑ</span>
                          <span>{{ formatNumber(tweet.retweets) }}</span>
                        </div>
                        <div class="flex items-center gap-1">
                          <span>‚ù§Ô∏è</span>
                          <span>{{ formatNumber(tweet.likes) }}</span>
                        </div>
                        <div class="flex items-center gap-1">
                          <span>üëÅÔ∏è</span>
                          <span>{{ formatNumber(tweet.views) }}</span>
                        </div>
                        <div class="ml-auto flex items-center gap-1">
                          <span class="text-xs">Engagement:</span>
                          <span class="text-xs font-semibold">{{ getEngagementRate(tweet).toFixed(2) }}%</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              }
            </div>
          }

          <!-- Empty State -->
          @if (!loading() && selectedProfile() && tweets().length === 0) {
            <div class="p-12 text-center">
              <div class="text-6xl mb-4">üì≠</div>
              <h3 class="text-xl font-semibold text-gray-700 mb-2">No Tweets Yet</h3>
              <p class="text-gray-600">Tweets will appear here once they are fetched from this profile</p>
            </div>
          }
        }

      </div>
    </div>
  </div>
</div>