<div
  class="bg-neutral-900 dark:bg-neutral-950 p-6 rounded-2xl shadow-md border border-neutral-700 dark:border-neutral-800 max-w-lg"
>
  <h2 class="text-lg font-semibold mb-4 text-white">ğŸ” LLM Credentials</h2>

  <form (ngSubmit)="saveCredentials()" class="space-y-4">
    <!-- Provider -->
    <div>
      <label class="block text-sm font-medium text-gray-300 dark:text-gray-200 mb-1"
        >Provider</label
      >
      <select
        class="w-full p-2 rounded bg-neutral-800 border border-neutral-700 dark:border-neutral-600 text-gray-100 dark:text-gray-200"
        [(ngModel)]="selectedProvider"
        name="provider"
      >
        <option *ngFor="let provider of providers" [value]="provider">
          {{ provider | titlecase }}
        </option>
      </select>
    </div>

    <!-- API Key -->
    <div>
      <label class="block text-sm font-medium text-gray-300 dark:text-gray-200 mb-1">API Key</label>
      <input
        type="password"
        [(ngModel)]="apiKey"
        name="apiKey"
        class="w-full p-2 rounded bg-neutral-800 border border-neutral-700 dark:border-neutral-600 text-gray-100 dark:text-gray-200"
        placeholder="Enter your API key"
      />
    </div>

    <!-- Base URL (optional) -->
    <div>
      <label class="block text-sm font-medium text-gray-300 dark:text-gray-200 mb-1"
        >Base URL (optional)</label
      >
      <input
        type="text"
        [(ngModel)]="baseUrl"
        name="baseUrl"
        class="w-full p-2 rounded bg-neutral-800 border border-neutral-700 dark:border-neutral-600 text-gray-100 dark:text-gray-200"
        placeholder="e.g. http://localhost:11434"
      />
    </div>

    <!-- Model Name -->
    <div>
      <label class="block text-sm font-medium text-gray-300 dark:text-gray-200 mb-1"
        >Model Name (optional)</label
      >
      <input
        type="text"
        [(ngModel)]="modelName"
        name="modelName"
        class="w-full p-2 rounded bg-neutral-800 border border-neutral-700 dark:border-neutral-600 text-gray-100 dark:text-gray-200"
        placeholder="e.g. gpt-4-turbo"
      />
    </div>

    <!-- Temperature -->
    <div>
      <label class="block text-sm font-medium text-gray-300 dark:text-gray-200 mb-1"
        >Temperature (optional)</label
      >
      <input
        type="number"
        [(ngModel)]="temperature"
        name="temperature"
        step="0.1"
        class="w-full p-2 rounded bg-neutral-800 border border-neutral-700 dark:border-neutral-600 text-gray-100 dark:text-gray-200"
        placeholder="0.7"
      />
    </div>

    <!-- Submit -->
    <button
      type="submit"
      [disabled]="isSaving()"
      class="w-full py-2 rounded bg-blue-600 hover:bg-blue-700 transition text-white font-medium"
    >
      {{ isSaving() ? 'Saving...' : 'Save Credentials' }}
    </button>
  </form>

  <p *ngIf="message()" class="mt-3 text-sm text-gray-300 dark:text-gray-200 text-center">
    {{ message() }}
  </p>

  <!-- Connected Credentials List -->
  <div class="space-y-4 py-4">
    @for(credential of credentials(); track credential.id){
    <div
      class="bg-white dark:bg-neutral-900 rounded-xl shadow-sm border border-neutral-200 dark:border-neutral-800 p-6"
    >
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
          <div>
            <h4 class="font-semibold text-gray-900 dark:text-white">{{ credential.modelName }}</h4>
            <p class="text-sm text-neutral-600 dark:text-neutral-400">{{ credential.baseUrl }}</p>
            <span class="text-xs text-neutral-500 dark:text-neutral-400"
              >{{ credential.provider }}
            </span>
            <span class="text-xs text-neutral-500 dark:text-neutral-400"
              >{{ credential.apiKey }}
            </span>
            <span class="text-xs text-neutral-500 dark:text-neutral-400"
              >{{ credential.temperature }}
            </span>
            <span class="text-xs text-neutral-500 dark:text-neutral-400"
              >{{ credential.created_at }}
            </span>
          </div>
        </div>

        <div class="flex items-center gap-3">
          <button
            (click)="deleteCredential(credential)"
            class="px-4 py-2 text-sm text-error-600 hover:bg-error-50 rounded-lg"
          >
            Remove
          </button>
        </div>
      </div>

      <!-- Expiry Warning -->
    </div>
    <!-- Empty State -->
    @if (credentials().length === 0) {
    <div
      class="bg-white dark:bg-neutral-900 rounded-xl shadow-sm border border-neutral-200 dark:border-neutral-800 p-12 text-center"
    >
      <div class="text-6xl mb-4">ğŸ”—</div>
      <h3 class="text-xl font-semibold mb-2">No Connected LLM Credentials</h3>
      <p class="text-neutral-600 dark:text-neutral-400">Connect your LLM's to use insights.</p>
    </div>
    } }
    <div></div>
  </div>
</div>
