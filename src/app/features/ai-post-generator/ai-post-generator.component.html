<div class="max-w-4xl mx-auto p-6">
  <h2 class="text-3xl font-bold mb-6 text-gray-900 dark:text-white">ðŸ¤– AI Post Generator</h2>

  <!-- Step 1: Get Insights -->
  <div
    class="bg-white dark:bg-neutral-900 rounded-xl shadow-sm border border-gray-200 dark:border-neutral-800 p-6 mb-6"
  >
    <h3 class="text-xl font-semibold mb-4 text-gray-900 dark:text-white">1. Generate Insights</h3>

    <div class="space-y-4">
      <div>
        <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-200"
          >Topic (optional)</label
        >
        <input
          [value]="topic()"
          (input)="topic.set($any($event.target).value)"
          type="text"
          placeholder="e.g., artificial intelligence, web3"
          class="w-full px-4 py-2 border border-gray-300 dark:border-neutral-600 dark:bg-neutral-800 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500"
        />
      </div>

      <div>
        <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-200"
          >AI Provider</label
        >
        <select
          [value]="llmProvider()"
          (change)="llmProvider.set($any($event.target).value)"
          class="w-full px-4 py-2 border border-gray-300 dark:border-neutral-600 dark:bg-neutral-800 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500"
        >
          <option value="openai">OpenAI (GPT-4)</option>
          <option value="gemini">Google Gemini</option>
          <option value="claude">Claude</option>
          <option value="ollama">Ollama (Local)</option>
        </select>
      </div>

      <button
        (click)="generateInsights()"
        [disabled]="generatingInsights()"
        class="w-full px-6 py-2 bg-indigo-600 hover:bg-indigo-700 dark:hover:bg-indigo-500 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
      >
        {{ generatingInsights() ? 'Generating...' : 'âœ¨ Generate Insights' }}
      </button>
    </div>

    @if (insights().length > 0) {
    <div class="mt-6 space-y-3">
      <h4 class="font-semibold text-gray-900 dark:text-white">Generated Insights:</h4>
      @for (insight of insights(); track $index) {
      <div
        class="p-4 bg-gray-50 dark:bg-neutral-800 rounded-lg border border-gray-200 dark:border-neutral-700"
      >
        <div class="flex items-start gap-3">
          <input
            type="checkbox"
            [checked]="selectedInsights()[$index]"
            (change)="toggleInsightSelection($index)"
            class="mt-1 w-4 h-4 text-indigo-600 dark:text-indigo-400 rounded focus:ring-indigo-500"
          />
          <div class="flex-1">
            <h5 class="font-semibold text-sm text-gray-900 dark:text-white">{{ insight.title }}</h5>
            <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">{{ insight.description }}</p>
            <span class="text-xs text-gray-500 dark:text-gray-500 mt-2 inline-block">
              Relevance: {{ (insight.relevanceScore * 100).toFixed(0) }}%
            </span>
          </div>
        </div>
      </div>
      }
    </div>
    }
  </div>

  <!-- Step 2: Generate Post -->
  <div
    class="bg-white dark:bg-neutral-900 rounded-xl shadow-sm border border-gray-200 dark:border-neutral-800 p-6"
  >
    <h3 class="text-xl font-semibold mb-4 text-gray-900 dark:text-white">
      2. Generate Post Template
    </h3>

    <div class="space-y-4">
      <div>
        <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-200"
          >Platform</label
        >
        <select
          [value]="platform()"
          (change)="platform.set($any($event.target).value)"
          class="w-full px-4 py-2 border border-gray-300 dark:border-neutral-600 dark:bg-neutral-800 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500"
        >
          <option value="twitter">Twitter/X</option>
          <option value="instagram">Instagram</option>
          <option value="facebook">Facebook</option>
          <option value="linkedin">LinkedIn</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-200">Tone</label>
        <select
          [value]="tone()"
          (change)="tone.set($any($event.target).value)"
          class="w-full px-4 py-2 border border-gray-300 dark:border-neutral-600 dark:bg-neutral-800 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500"
        >
          <option value="professional">Professional</option>
          <option value="casual">Casual</option>
          <option value="humorous">Humorous</option>
          <option value="informative">Informative</option>
          <option value="engaging">Engaging</option>
        </select>
      </div>

      <button
        (click)="generatePost()"
        [disabled]="!hasSelectedInsights() || generatingPost()"
        class="w-full px-6 py-2 bg-indigo-600 hover:bg-indigo-700 dark:hover:bg-indigo-500 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
      >
        {{ generatingPost() ? 'Generating...' : 'ðŸš€ Generate Post' }}
      </button>
    </div>

    @if (generatedPost()) {
    <div
      class="mt-6 p-4 bg-gray-50 dark:bg-neutral-800 rounded-lg border border-gray-200 dark:border-neutral-700"
    >
      <div class="flex items-start justify-between mb-4">
        <h4 class="font-semibold text-gray-900 dark:text-white">Generated Post:</h4>
        <button
          (click)="copyToClipboard()"
          class="text-sm text-indigo-600 dark:text-indigo-400 hover:text-indigo-700 dark:hover:text-indigo-300 transition-colors"
        >
          ðŸ“‹ Copy
        </button>
      </div>

      <div class="prose max-w-none">
        <p class="whitespace-pre-wrap text-gray-900 dark:text-gray-100">
          {{ generatedPost()?.content }}
        </p>

        @if (generatedPost()?.hashtags?.length > 0) {
        <div class="mt-4">
          <strong class="text-sm text-gray-900 dark:text-white">Suggested Hashtags:</strong>
          <div class="flex flex-wrap gap-2 mt-2">
            @for (tag of generatedPost()?.hashtags; track tag) {
            <span
              class="px-3 py-1 bg-indigo-100 dark:bg-indigo-900/50 text-indigo-700 dark:text-indigo-300 rounded-full text-sm"
            >
              #{{ tag }}
            </span>
            }
          </div>
        </div>
        }

        <div class="mt-4 text-sm text-gray-600 dark:text-gray-400">
          <strong>Estimated Reach:</strong> {{ generatedPost()?.estimatedReach }}
        </div>
      </div>

      <button
        (click)="usePostInComposer()"
        class="w-full mt-4 px-6 py-2 bg-gray-600 hover:bg-gray-700 dark:bg-neutral-700 dark:hover:bg-neutral-600 text-white rounded-lg transition-colors"
      >
        Use in Post Composer
      </button>
    </div>
    }
  </div>
</div>
